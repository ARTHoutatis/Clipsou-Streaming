<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <!-- Maintenance mode check -->
  <script src="maintenance.js"></script>
  <title>Proposer un film – Clipsou Streaming</title>
  <link rel="icon" href="images/favicon.webp" type="image/webp">
  <link rel="stylesheet" href="request.css?v=1">
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <main class="container" id="app">
    <div class="header">
      <div>
        <h1>📽️ Proposer un film</h1>
        <div id="userInfo" class="user-info" hidden></div>
      </div>
      <div class="header-actions">
        <button type="button" id="logoutBtn" class="btn secondary" hidden>🚪 Se déconnecter</button>
        <a href="/" class="btn secondary back-btn">← Retour à l'accueil</a>
      </div>
    </div>

    <!-- Pending request notification -->
    <div id="pendingRequestNotice" class="notice notice-info" hidden>
      <strong id="pendingNoticeTitle">📋 Demande en cours</strong>
      <p id="pendingNoticeMessage">Vous avez une demande en attente de validation par les administrateurs.</p>
      <div class="pending-details" id="pendingDetails"></div>
      <div class="pending-actions">
        <button type="button" id="cancelRequestBtn" class="btn danger">Annuler ma demande</button>
        <button type="button" id="newRequestBtn" class="btn primary" hidden>Nouvelle demande</button>
      </div>
    </div>

    <!-- Stepper Navigation -->
    <div class="stepper-container" id="stepperContainer">
      <div class="stepper">
        <div class="step active" data-step="1">
          <div class="step-circle">1</div>
          <div class="step-label">Conditions</div>
        </div>
        <div class="step-line"></div>
        <div class="step" data-step="2">
          <div class="step-circle">2</div>
          <div class="step-label">Connexion</div>
        </div>
        <div class="step-line"></div>
        <div class="step" data-step="3">
          <div class="step-circle">3</div>
          <div class="step-label">Guide</div>
        </div>
        <div class="step-line"></div>
        <div class="step" data-step="4">
          <div class="step-circle">4</div>
          <div class="step-label">Formulaire</div>
        </div>
      </div>
    </div>

    <!-- Slides Container -->
    <div class="slides-container">
      <!-- Slide 1: Terms and Conditions -->
      <section class="form-section terms-section slide active" data-slide="1">
        <h2>📜 Conditions d'utilisation</h2>
      <div class="terms-content">
        <p class="terms-intro">Avant de soumettre votre demande, veuillez lire attentivement et respecter les conditions suivantes :</p>
        <ul class="terms-list">
          <li>
            <strong>✅ Remplissez tous les champs</strong>
            <p>Assurez-vous de compléter tous les champs requis du formulaire avec des informations exactes et complètes.</p>
          </li>
          <li>
            <strong>🚫 Pas de trolling</strong>
            <p>Les demandes fantaisistes, offensantes ou non sérieuses seront automatiquement rejetées et pourront entraîner un blocage.</p>
          </li>
          <li>
            <strong>🎥 Films uniquement</strong>
            <p>Cette plateforme est dédiée aux FILMS. Ne soumettez pas de vidéos courtes, sketches, vlogs ou autres contenus non-cinématographiques.</p>
          </li>
          <li>
            <strong>⏱️ Une demande par jour</strong>
            <p>Vous êtes limité à une seule demande par période de 24 heures. Vous pouvez annuler votre demande actuelle pour en soumettre une nouvelle.</p>
          </li>
        </ul>
        <div class="terms-accept">
          <label class="checkbox-label">
            <input type="checkbox" id="termsAccepted" required>
            <span>J'ai lu et j'accepte les conditions d'utilisation ci-dessus</span>
          </label>
          <div id="termsError" class="error-message" hidden>
            ⚠️ Vous devez accepter les conditions d'utilisation pour soumettre votre demande.
          </div>
        </div>
        <div class="slide-nav">
          <button type="button" class="btn primary" id="nextStep1">J'accepte →</button>
        </div>
      </div>
      </section>

      <!-- Slide 2: Google OAuth Login -->
      <section class="form-section auth-section slide" data-slide="2">
        <h2>🔐 Connexion requise</h2>
        <p class="auth-description">Pour soumettre un film, vous devez vous connecter avec votre compte Google et vérifier que vous êtes propriétaire de votre chaîne YouTube.</p>
        
        <div class="auth-reasons">
          <h3>Pourquoi cette connexion ?</h3>
          <ul>
            <li>✅ Vérifier que vous êtes propriétaire de la chaîne YouTube</li>
            <li>✅ Éviter les soumissions frauduleuses</li>
            <li>✅ Protéger les créateurs de contenu</li>
            <li>✅ Associer vos demandes à votre compte</li>
          </ul>
        </div>

        <div id="googleSignInButton" class="google-signin-container"></div>
        
        <div id="authError" class="error-message" hidden></div>
        
        <div class="auth-footer">
          <p class="small muted">En vous connectant, vous acceptez que nous accédions aux informations de votre chaîne YouTube pour vérifier votre propriété.</p>
          <p class="small muted" style="margin-top: 8px;">
            <a href="privacy.html" target="_blank" rel="noopener noreferrer" style="color: #3b82f6; text-decoration: none;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
              </svg>
              Consulter notre politique de confidentialité
            </a>
          </p>
        </div>
        
        <div class="slide-nav" id="authNextNav" hidden>
          <button type="button" class="btn secondary" id="prevStep2">← Retour</button>
          <button type="button" class="btn primary" id="nextStep2">Suivant →</button>
        </div>
      </section>

      <!-- Slide 3: Tutorial Section -->
      <section class="form-section tutorial-section slide" data-slide="3">
        <h2>📚 Guide visuel des images</h2>
      <p class="tutorial-intro">Voici un exemple de carte de film pour vous aider à comprendre le positionnement des différentes images :</p>
      <div class="tutorial-card-wrapper">
        <div class="tutorial-card">
          <div class="tutorial-card-media">
            <div class="tutorial-overlay">Affiche Portrait</div>
            <div class="tutorial-label portrait">Format 9:12 (vertical)</div>
            <div class="tutorial-badge-overlay">
              <div class="tutorial-badge">Badge Studio</div>
            </div>
          </div>
          <div class="tutorial-card-content">
            <div class="tutorial-rating">Note du contenu</div>
          </div>
        </div>
        <div class="tutorial-fiche">
          <div class="tutorial-fiche-image">
            <div class="tutorial-overlay">Image Fiche</div>
            <div class="tutorial-label landscape">Format 16:9 (paysage)</div>
          </div>
          <p class="tutorial-note">Cette image s'affiche sur la page détaillée du contenu</p>
        </div>
      </div>
      <div class="tutorial-tips">
        <h3>💡 Conseils pour vos images</h3>
        <ul>
          <li><strong>Affiche Portrait (9:12)</strong> - Utilisée sur les cartes de la page d'accueil. Taille recommandée : 540x720px minimum</li>
          <li><strong>Image Fiche (16:9)</strong> - Affichée sur la page de détail du contenu. Taille recommandée : 1920x1080px</li>
          <li><strong>Badge Studio</strong> - Logo de votre chaîne/studio pour différencier les créateurs. Fond transparent recommandé (.png). Taille : 200x80px</li>
          <li>Formats acceptés : JPG, PNG, WebP. Poids max : 10MB par image</li>
        </ul>
      </div>
      <div class="slide-nav">
        <button type="button" class="btn secondary" id="prevStep3">← Précédent</button>
        <button type="button" class="btn primary" id="nextStep3">Suivant →</button>
      </div>
      </section>

      <!-- Slide 4: Request Form -->
      <section class="form-section slide" id="requestFormSection" data-slide="4">
        <h2>🎬 Informations du contenu</h2>
      <form id="requestForm" autocomplete="off">
        <div class="grid">
          <label>
            <span>Titre <span class="required">*</span></span>
            <input type="text" id="title" required disabled>
          </label>
          <label>
            <span>Type <span class="required">*</span></span>
            <select id="type" required disabled>
              <option value="film" selected>Film</option>
              <option value="série">Série</option>
              <option value="trailer">Trailer</option>
            </select>
          </label>
        </div>

        <div class="grid">
          <label>
            <span>Genre 1 <span class="required">*</span></span>
            <input type="text" id="genre1" list="genresDatalist" required disabled placeholder="ex: Action" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false">
          </label>
          <label>
            <span>Genre 2 <span class="required">*</span></span>
            <input type="text" id="genre2" list="genresDatalist" required disabled placeholder="ex: Aventure" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false">
          </label>
          <label>
            <span>Genre 3 <span class="required">*</span></span>
            <input type="text" id="genre3" list="genresDatalist" required disabled placeholder="ex: Comédie" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false">
          </label>
        </div>

        <label>
          <span>Description <span class="required">*</span></span>
          <textarea id="description" rows="5" required disabled placeholder="Décrivez le contenu..."></textarea>
        </label>

        <div class="grid">
          <label>
            <span>Affiche (format 9/12) <span class="required">*</span></span>
            <input type="hidden" id="portraitImage">
            <div class="actions">
              <label class="btn file-label">
                Importer image
                <input type="file" id="portraitFileInput" accept="image/*" hidden disabled>
              </label>
              <button type="button" id="portraitClearBtn" class="btn secondary" disabled>Effacer</button>
            </div>
            <img id="portraitPreview" class="img-preview" alt="Aperçu portrait" hidden>
          </label>
          <label>
            <span>Image fiche (paysage 16/9) <span class="required">*</span></span>
            <input type="hidden" id="landscapeImage">
            <div class="actions">
              <label class="btn file-label">
                Importer image
                <input type="file" id="landscapeFileInput" accept="image/*" hidden disabled>
              </label>
              <button type="button" id="landscapeClearBtn" class="btn secondary" disabled>Effacer</button>
            </div>
            <img id="landscapePreview" class="img-preview" alt="Aperçu paysage" hidden>
          </label>
          <label>
            <span>Badge studio (image)</span>
            <input type="hidden" id="studioBadge">
            <div class="actions">
              <label class="btn file-label">
                Importer image
                <input type="file" id="studioBadgeFileInput" accept="image/*" hidden disabled>
              </label>
              <button type="button" id="studioBadgeClearBtn" class="btn secondary" disabled>Effacer</button>
            </div>
            <small class="muted" style="display:block;margin-top:4px;">💡 Votre dernier badge studio est automatiquement réutilisé</small>
            <img id="studioBadgePreview" class="img-preview" alt="Aperçu badge studio" hidden>
          </label>
        </div>

        <fieldset disabled>
          <legend>Acteurs & Doubleurs</legend>
          <div id="actorsList" class="actors-list"></div>
          <div class="actor-row">
            <input type="text" id="actorName" placeholder="Nom de l'acteur">
            <input type="text" id="actorRole" placeholder="Rôle">
            <button type="button" id="addActorBtn" class="btn secondary">Ajouter</button>
          </div>
        </fieldset>

        <fieldset disabled id="watchUrlFieldset">
          <legend>Lien de visionnage</legend>
          <label>
            <span>Lien YouTube <span class="required">*</span></span>
            <input type="url" id="watchUrl" placeholder="https://www.youtube.com/...">
            <div id="videoVerificationStatus" class="verification-status" hidden></div>
          </label>
        </fieldset>

        <fieldset disabled id="episodesFieldset" style="display:none;">
          <legend>Épisodes</legend>
          <div id="episodesList" class="actors-list"></div>
          <div class="actor-row">
            <input type="text" id="episodeTitle" placeholder="Titre de l'épisode" style="flex:2;">
            <input type="url" id="episodeUrl" placeholder="Lien YouTube de l'épisode" style="flex:2;">
            <button type="button" id="addEpisodeBtn" class="btn secondary">Ajouter</button>
          </div>
        </fieldset>
      </form>
      <datalist id="genresDatalist">
        <option value="Action">
        <option value="Aventure">
        <option value="Animation">
        <option value="Brickfilm">
        <option value="Comédie">
        <option value="Documentaire">
        <option value="Drame">
        <option value="Familial">
        <option value="Fantastique">
        <option value="Guerre">
        <option value="Historique">
        <option value="Horreur">
        <option value="Musical">
        <option value="Mystère">
        <option value="Policier">
        <option value="Romance">
        <option value="Science-Fiction">
        <option value="Super-héros">
        <option value="Thriller">
        <option value="Western">
      </datalist>
      <div class="slide-nav">
        <button type="button" class="btn secondary" id="prevStep4">← Précédent</button>
        <button type="button" id="submitBtn" class="btn primary">📤 Envoyer la demande</button>
        <button type="button" id="resetBtn" class="btn secondary">🔄 Réinitialiser</button>
      </div>
      </section>
    </div>
    <!-- End Slides Container -->

    <!-- Rate limit notification -->
    <div id="rateLimitNotice" class="notice notice-warning" hidden>
      <strong>⏳ Limite atteinte</strong>
      <p>Vous avez déjà soumis une demande aujourd'hui. Vous pourrez soumettre une nouvelle demande demain.</p>
      <p class="small" id="nextRequestTime"></p>
    </div>

    <!-- Request History -->
    <section class="form-section" id="historySection" hidden>
      <h2>📜 Historique de mes demandes</h2>
      <div id="historyList" class="history-list"></div>
    </section>

    <!-- Success Message -->
    <div id="successMessage" class="notice notice-success" hidden>
      <strong>✅ Demande soumise avec succès !</strong>
      <p>Votre demande a été envoyée aux administrateurs. Vous recevrez une réponse prochainement.</p>
      <p class="small">Vous pourrez soumettre une nouvelle demande dans 24 heures.</p>
    </div>
    </div><!-- End mainContent -->
  </main>

  <script src="config.js"></script>
  <script src="google-auth.js?v=20251031-buttonalign"></script>
  <script>
    // Load banned users data for verification (shared with admin via localStorage)
    window.ClipsouAdmin = window.ClipsouAdmin || {};
    window.ClipsouAdmin.isUserBanned = function(email, channelId) {
      try {
        const data = localStorage.getItem('clipsou_banned_users_v1');
        const banned = data ? JSON.parse(data) : [];
        return banned.some(user => {
          if (email && user.email === email) return true;
          if (channelId && user.channelId === channelId) return true;
          return false;
        });
      } catch {
        return false;
      }
    };
  </script>
  <script src="request.js?v=1"></script>
</body>
</html>
